## 開発計画
**現在目標**　


豚のシナリオ　人間の冬眠に対する研究機関も閉都市にはあるよ

攻撃計算式を　https://www5f.biglobe.ne.jp/~mixcandy/syumi-02.html
このやり方で、　平均値がやや上振れ下振れについて何が作用するか考える

慣れ補正　しきい値がデフォルト値から補正される最大の値に
**最終計算結果として近づけば近づくほど**、
何らかの形でそのしきい値デフォルト越えが押し戻されやすくなる。
（その押し戻しはどうする？）




![[#基礎計算]]

前のめりがいるのに後衛狙うときは威力も下がる？

味方の状態異常による味方攻撃値？
ある一定のhpを減らさないと行動不能、または味方に対する状態異常スキルの使用？
- だから**敵単体指定の時は味方単体指定と合わせて指定可能(一方を指定して消えない)**

回避の分類を分ける
	[[#回避]]
	[[#回避率]]
	[[#防御力・回避]]
	[[#スキル命中率、力、防御、回避の扱いについて]]

爆破型は前のめり状態だと完全回避不可能

ランダム範囲かつ、　選択できるなら？
- 前のめりを選ぶけど　全範囲になった場合
	- 前のめり側から威力割合の振り分け差分が配布されるみたいな

- skill.IsagressiveCommitはskillaiやスキル選択でtrueになる？(**実行すると前のめりになるかどうか**)
- canSekectAllyによって味方が大人しくそれを受け取るかどうかはパーティー属性次第
	- 味方非想定
		- 実行者は知覚せず事故によって発生してしまい、味方は想定していない
		- この場合**味方を選べない**
	- 味方想定
		- 想定したうえで受け取るかどうか
		- この場合**味方は選べる。**
	- この二要素は選択不可、スキルによって違う

スキルをインスペクタで管理しやすくするために、インスペクタ上でenemyの派生かどうか選べるシステムと同じものを採用できるようにする。

列挙体による対象者の選別の分岐と
実際の分岐された処理の中での
**skillAIや味方の選択画面による選ぶ意思**は
==baseSkillで独自実装するbool==で
同様に範囲攻撃の割合意思はリストに入れる順番で決めるから、
**同じように決められた選ぶ意思**(AttackDistributionType)によってSkillACTの対象者決定処理内でその割合範囲に同期した順番で入れられる

skillAIを作る
- スキルの必要Pointやhp、スキル性質などに合わせてスキルリストの中から選び出す
- 直接指定するんだったらシリアライズと照らし合わせてインデックスで指定すればいい。
- 敵が対象者を選ぶ事も加味しないと

先ずは敵AI
スキルの選ぶ処理　aiとかskillのgameObjectとか
- 逃走は味方のスキル選別時に行える。

後ろの奴が後ろの奴を攻撃したらどうなる？
(そこらへんの前のめり後衛の基本的な命中率補正の変化を整える)
- 前のめりが後衛攻撃したら命中率下がるけど、じゃあ後衛が攻撃したら...ってことを考えると？
	- そもそも後衛が後衛のまま攻撃したら命中下がるようにしたら？
- つまり
	- 後衛のままだと行動命中が下がり、
	- 相手の後衛を狙った行動だとさらに下がる。

==skillAIまで実装したらいい加減テストしよう==

キャラコンフィグの部分に慣れ補正のさまざまについて表示
また、敵キャラに無数のスキルを**順番に使わせ**、それで慣れ補正のテストをしよう。

挑発属性の攻撃では自分が一定ターン数数割の確率で攻撃されやすくなるが、
- 特定の精神属性(利き方の違い、付き方の違い確率とか)
- 機械の種別(イラつきは付かない)
には正常に動作しない
また、その場合状態異常での　<イラつき→(キャラ名)>
で表され、一番多いイラつきの相手が判定される。
イラつき攻撃時強制的に**前のめり**になる。
また、イラついたあいてを狙う際、命中などに補正は掛からない。(遠ければ当たるわけなんてない。)
また、イラつきの減衰は精神属性で別れ、イラつきの所持を一定数超えると、どのキャラクタにも
1.25~1,75倍の攻撃となる。　

機械系の敵のスキルにはそういうの関係なしに、攻撃を自分に吸い付ける物があると思う。





アイテム使用について(武器)
あの世みたいなアイテム欄に放置してある武器アイテムの説明欄に、
今誰が装備してるのかが出てくる。
武器の熟練度と武器自体のHSPV(レベル)がある。

ジュエリーソード　　←ニンブレイド的な

スキル誘発または色覚攻撃、イベントコマンドでの各種イベントにアイテムの仕様によって
特定の二脳が露出
語られていたキャラクターとの関連や、
特殊なパッシブとしての機能

例　二脳・キルナートの露出
記憶・魔法の露出

スキルの追加効果はそれぞれの性質(atk,healとか)の本文の後ろに
/連続効果(3)/ みたいに加算する


スキルレベルによるスキルの違いは
リスト化、または直接共通処理をプログラム内に？



==複数回攻撃の挙動は**物理属性によって変える？**==




かばうやつは何属性？　かばうときの文章の分岐？
精神属性由来のかばい確率の辞書クラス作成しよ


後衛を狙うと前のめり者のagiによっては反撃を食らう？
反撃は




スキルによりクリティカル時の文章が変る
TLOAはゾテロまたはイテル
魔法はスライディング
純然な物理のみの物はガルガンチュア
- 魂の解放は違う（個人のアレだから）
- 科学は複合的なアレなので最終的な出力結果を加味して変える
- クリティカルレベルにより・の所になんか付くかも


特殊要望
- 敵からの先手に限り、エンカウントの時の歩きボタン押した瞬間に即食らう　
	- encountした時のbmの敵先手だった場合に、
	  ==次のボタンに委ねられる前に**エンカウント最後の処理で最初の敵ACTを実行**？==
- クリティカルなどの**攻撃後に発生した的な**やつはあの世みたいに改行[]メッセージで記す
	- クリティカルは　ｶﾞﾙｶﾞﾝﾁｭｱ！　って表記


スキルの作成　ジーノ辺りから
[[TLOA汎受性]]の主人公クラス前提の作りから設計する。

主人公達のスキルとか敵とか、
その他ライバハルとかを埋めつつ、実際のactpartsを交えた処理を


passiveはそもそもapplypassiveとか外れるときとかの段階で
他のpassiveの影響が他のpassiveに出るとかやればいい
passiveには
- 歩行効果と
- timelineにより挟まれる定期戦闘効果
- 行動時効果(SkillACT)
辺りが基本？

状態異常は一つのmanagerの3ターン事に発動
つまり一回の処理関数の最後に強制的に入れられる？

actlistにどのタイミングでどのくらい行動リストを追加したり
すればいい

actlistを用いたバトルの進み
とりあえずACTlistから処理するものの詳細
- 攻撃の処理
- 攻撃選択
	- 味方キャラは操作するが敵はなし？
- ネクストウェイト
	- >>←これ
	- 登録されたメッセージ
	- 背景画像？

このstateは
stateによる各状態の（例えば攻撃スキル部分とか）状態は各stateの状態によって
紐づくゲームオブジェクト自体に貼っつけた
スクリプトによって管理する
範囲をプレイヤーに理解させる

enemyGroupのキャラや味方キャラは、
その**キャラのクラス**に紐づいたgamObjectを操作することで
視覚上のリアクションを示すようにする？

味方キャラのバトルターンの前に
味方キャラのコマンド選択フェーズをactListに
actpartの種類として生成するといい





スキルセットだと多様な敵キャラの実装に制限がかかるから、
内部的な傾向に反映するようにする。
それにはその==種別名==から得られるイメージを可能な限り
クラス内部の仕様に反映させる
[[#種別]]

味方キャラのスキルはgameObjectと結びつける
- skillListは精神属性などの内部的な処理
- gameObjectはプレイヤーの選ぶui処理として


//ランダムターンシステムで次の三、四人をランダム選別する。三回以上同じ人が選ばれないようにセーブとかはする
//3～4人分の戦闘処理をUniTaskでする。　最後の所で次の行動リストを補充する。

timelineでallactlistですべての挙動を管理
何ターンごとに何かを入れるとかの処理
managerのbattleTurnとか状態異常ターンとかが
何ターン後とかにはいる

battlemanager unitaskの処理
敵も味方もその瞬間に処理。
遅延処理などは各ユニット内部で行う？

walking側で最初の戦闘で操るオブジェクトを整えとく
後はbattlemanagerやtimelineのr3Observerでオブジェクトに対する操作が自動で行われる
ジェネリッククラスを使えば戦闘ごとに変わる操作対象を柔軟に変えられる
(戦闘時に扱うグラフィックの対象とか)

waveはuserUI?
アイコンについて
- EYEAREA側は<mark style="background: #D2B3FFA6;"><mark style="background: #FFB8EBA6;">敵味方共通</mark></mark>で、**死んでるかどうかのバツ印**と、**前のめり表示**と、
  ダメージ時の**点滅**。**死にかけの時の裏赤緩やかな点滅**
- userUI側のMainスキル選択画面に**HPゲージとPの数字表記**

HPゲージ　P　の味方UI Pは左上とか右上に数字を直接
強制エンカウントボタンを作り、
エンカウントで敵と味方を集めて、配置
ボタンの移行も
その時戦ってるキャラの味方の詳細なstatusはcharaConfyに映る
アイテムはmainから



蝶のステージの敵と、
彼らの使うスキルを考える
[[蝶に占拠された電さい門の辺り]]




ズームに影響されずぱっと現れて、
周りを円状に動く丸い円がタラタタって感じで最初だけ回る感じ
waveは方向性だけチラッと見えるように薄く作用する感じで



味方の非文字系のステータスUIを考えなきゃいけない。

エンカウントウェーブの背景を暗くせずに簡易的なインパクトを与えるような改造を
する。色とか形に伴った歪みなど？
それとエンカウントウェーブは先手かどうかでその動く方向とか違ったはず

[[#背景の構成]]

![[#エンカウント]]

エンカウントする瞬間にはサイドオブジェクトは出てこない？
争いが終わると元の画角に一瞬で戻って既にサイドオブジェクトはある？

![[思考図]]

単純に拡大し、敵が眼前に並ぶ。(敵はズームした後の配置でズームに対応せずに発生する。)
そのroadとcharsの組み合わせ状態の画面をリール回転して、
複数戦を演出すればいいと思う。
**リール回転中にcharsを切り替えるみたいな**


カメラ移動の仕組み
ズームする　キャラにいらないキャラいたらそいつはcharaからフェードして消える。
- cloudのtextureのoffsetを微妙に動かす。2人目ならtimescaleや靄の動き方を逆転させるとか
- もし一人エンカウントなら、その他のメンバーをchars(root)から外す、
  待機列のcharasに入り、エンカウントした物からchars2に入って敵と一緒のグループに描画される感じ


基本道を歩いている時に
アイコンのまんまでエンカウントしたら、
それは戦闘のみで、強制会話イベントも
選択的会話イベントも専用のグラフィックウィンドウを用いた画面で行われる
その画面で




エンカウントの流れをwalkingのencountから
- 実際の戦闘処理はbattleTimeline
	- 視覚的なズーム処理はwuiから行う。
	- wuiはwalkingからtimelineに渡す
	- timelineのr3を利用したオブザーバーを用いて、
	  walkingからwuiの操作プリセットが動作？

エンカウント時の敵キャラを実際に並べてそれに伴うズームの処理を、
battletimelineから行う

蝶の敵のコラージュアニメーション作って虫の敵とする

<mark style="background: #FFB8EBA6;">ウトナみたいにエンカウント時に、
カメラが寄るようにする、敵以外のbackgroundが。
その為には、カメラ操作とsprite rendererに置き換えるまたはui imageのゴリ押し。なお、ウトナと同じように動く背景にブラーがかかり、色が変化するようにする。（色とかはencount waveとかで代用？）</mark>

エンカウントカメラズームで
サイドオブジェクトをバラすことで乱雑な背景にする
この際にサイドオブジェクトの揺れを[[乱雑なサイドオブジェクトのコード]]にする


EYEAREAで背景を司るスクリプトとオブジェクト設計
- その外側を満たすノイズの海
	- そのノイズから敵が出てくる時の==種別による立ち絵の違い==
		- 生命はフェードイン
		- 機械はそのまま
		- TLOAは半透明のまんま
- 敵の視覚的表現
	- 二種類ある
		- 敵の<mark style="background: #FFF3A3A6;">固定チーム系</mark>か<mark style="background: #ABF7F7A6;">自由系</mark>かでテキストエリアと敵グラの配置関係が変わる。
	- 敵のテキストエリア
		-

敵の固定チームはパーティー属性もそれぞれの属性も固定。
路人は==ロードグラフィックから起き上がるように出てきて、TIMELINEで優先的に処理される。==

ストーリーテキスト
ステージ間ストーリーとは違うウィンドウ式　ステージ間は雪道のパクリ
![[Drawing 2024-10-17 18.50.54.excalidraw]]

![[タイトルなし.png|200]]
エンカウントの波は
**その逆の左右から上から**襲ってくるようにある。
逆にこっちから先手必勝型エンカウントしたら、
押したボタンの**左右の下側からエンカウントの波が飛ぶ**。

エンカウントはnoiseSeaは使うか？？？
- スキル？
- ボスエンカウント??

<mark style="background: #FFF3A3A6;">エンカウントする際にRandomExtensionsの重み付け抽選が使えるかも。</mark>
<mark style="background: #D2B3FFA6;">ランダムターン制において,RandomExtensionsとLinqの合わせ技</mark>


BattleTIMELINはシングルトン?

![[Drawing 2024-10-04 22.52.55.excalidraw]]


親敵テキストエリアを背景オブジェクトに合わせた三人設定ロジックで
エリア内に適切に設定するロジックのワンパーツとして用いる。


敵と味方のバトルアイコンのgameObjectとスクリプト制作。
![[敵のバトルアイコン|900]]
![[ロードオブジェクト|200]]

encountしたら、walkbtnが使えなくなり、
敵のバトルアイコンと味方のバトルアイコンを司るオブジェクトが
trueになって、battlemanagerや、USERUIのボタンと処理が結びついたりする？

敵リストから[[豚岬の戦闘の運び　エンカ基礎1]]を使い、encount関数からの抽象的な
流れを作る

敵のエリアが出てくるとワンテンポ遅れて、敵のパーティー属性の記述が出てくる
ダン、バァン　ッテ感じで　
**その出方はいわゆる非同期で、コマンド操作はエンカウントした瞬間に**
**操作可能**


ポストプロセスでまるでunityremoteを使ってるかのように全体的に低画質化させる。

vfxgraphが使えるかも？


## ui計画
### 基礎想起
![[豚岬基礎ui.png]]
天気窓はUSERUIのどっかに入れとく。　~~またはskyrainシステムで流す。~~
と思ったがあれは背景をボツらせることで生える心情的ゲームシーンに映える奴であって、
俺の下手な背景の上では絵としての下手さがただ強調されるのみなので、
スカイショットrpgの優秀な天気窓を利用する。
でもやっぱり現在の背景システムの想定だとskyrainでもいけるかも

スキルカテゴリからスキルへの遷移
気力などの画面を　babaisyou のポーズ時の
配置と動き参考に作る。(三人の共通系のステータスとして使用？)

### ダークモード対応
ネガのポストエフェクトかけるか
androidのネイティブ自前判定で頑張ろうかな！
設定からネガをかけるか一気にダークモードに変更するとか！
その際noiseSeaの白黒とかも反転するね
### 内部構成
- AlwaysCanvas
	- 常に動いてるimage等を扱う。
- DynamicCanvas
	- たまに動いたりするuiを扱う。
- ~~StableCnavas~~（<mark style="background: #CACFD9A6;">複雑化するのでDynamicで代用</mark>）
	- 決して動かないようなUIを扱う
- 参考　[【Unity】Canvasでパフォーマンスに関わることについて調べてみた - げぇむぷろぐらみんぐ (hatenablog.com)](https://siguma-sig.hatenablog.com/entry/2018/08/11/095156#%E5%8B%95%E3%81%8FUI%E3%81%A8%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84UI%E3%81%A7Canvas%E3%82%92%E5%88%86%E3%81%91%E3%82%8B)


## 雑多
ゲームプロセスのページ　→　[[豚岬のプロセス具現]]
pは自然回復する。

トラベラーズシャッフル
天気は精神の属性に影響?---その時の属性の組み合わせの続いた時間などを要素に、
ランダムで天気を変えるメゾット？？

全員のHPが減れば減るほど
それぞれのステータスが上がり、
逃走確率はさがっていく?

### TLOAの実験都市([[正当な廃都市|閉都市]])であることと、主人公達の[[二脳]]等の離人的特徴。またスキルにより切り替わる精神属性システムのこと
スキルやるだけでポンポン性格変わるのって、
敵ならTLOAのようなものが集まってるし、
主人公達は複数の顔を持つ[[二脳]]みたいな精神エリートだらけだし、あってるくねいろいろと

### bgm
https://youtu.be/uAXxrS2I4jg?si=_FQPmrzEYdBTnkFN
これずっとループするだけ
==ゲーム中は一切bgmが変わることはない。==(コンフィグから消せるけど。)
ただ、ゲームを開始したときのステージの位置によってBGMが変わるのかもしれない。
この**開始時BGMシステム**はコンフィグによる切り替えでも反応するかもね

[【フリーBGM】ボスバトル 式の継承者【作業用BGM】 - YouTube](https://www.youtube.com/watch?v=fhvnxGYAs3U)
https://audiostock.jp/audio/favorite_list ←<mark style="background: #BBFABBA6;">効果音の一部も</mark>
~~雪道と同じbgmシステムなので、~~
~~ステージ間のストーリーと、実ステージ上でのストーリーはその感情曲線が一致するようにする。~~
~~例: スカイショットがアルテマルフトさんを見て絶望　階段たちは急に放出された世界に驚く~~
### タイトル画面
イカダ漕ぎと同じ　タイトルのみが書かれた画面をタップすると
その画面が同じ効果音で、下から上へとイージングして開く。(イージングじゃなくてもいいかな)
起動するたびに
- パーティーの健康状態
- ストーリーとかステージ、さらにはAreaCut
などの条件でタイトル文字の下に書かれるビジュアルが変わる。
ビジュアルはラフなループアニメーションのが、[[#bgm]]と相性がいいと思う

ステージ名とエリアカットと豚岬か廃都市かどうかがビジュアルの上に、というかタイトル文字の真下に書かれる。
### USERUIとEYEAREA
基本的に動的な動きは全てのEYEAREAに映し、
USRUIはタブメニューが基本で精々キャラのスキルボタンが震えたりする程度。
### 太字ボタン
太字ボタンは周りに点々が薄っすらフェードしつつ回転して押すべき
### USERUIの状態(reactiveProperty(TabState)
staticなreactivePropertyを利用して、
どこから変化させても自動で
MainとCharaConfyのタブがそれぞれの状態に変化するようにしてある。

### タブ挙動(USERUI)
#### 選ばれてないとき
豚岬のタイトルとクレジットとかイントロとかがボタンである。
例えばステージクリアするたびにタブは選ばれてないことになるので、
ステージ間のストーリー終わってゲーム画面に戻るたびにタブメニューがタイトルに戻ってる感じ
## サウンドデザイン
### しおかぜのジャミング音
このジャミングを [[ハイヤーセルフ]]との断絶だと解釈し、
死にかけるとそういう音が出る、または恒常的に発生？
## 歩き(WalkProcess)
基本的にそこから行けるエリアが複数あるならば幾ほどかで分岐があり、　
そのエリアをゴールすることで先に進める。
ボスの範囲内に入り、その状態で[[evilsearh]]を利用すると、先のゴールが解放され、
**ボスは選択することでエンカウントが出来るようになる。**

確定で敵が現れるポイントがある。
システム的にボスのエリアに入るまでの間に存在したりする
### サイドオブジェクト
#### プロパティ
##### セルフビルド (蟻鱒鳶ル)
独自
##### 安全建築
### 都市災害化システム
- 火災旋風イベントを起こせるアイテムだかイベント連鎖だかをこなすと、
- 都市に災害化の==ステージPassive==が付く。
	- [[#サイドオブジェクト]]の変化や、全体的な景観の変化、
	- 敵戦でのこちらの有利を得ることが出来る。(敵の本体が建物にいるタイプの敵=TLOA)
### 味方グループの戦闘状態のデフォルト値の変化
バトルの最後に利用したスキルによって次のバトル
での最初の精神属性が操作できるとなるとつまらないから
**一定の歩数を歩くと精神属性がデフォルト値になるようにする。**
また、イベント等でも変化したりする。(状態異常とか？)
<mark style="background: #ABF7F7A6;">たまにそのデフォルト値もストーリーやらなんやらで歪むことがある？</mark>
「○○は気持ちが落ち着いた...」

同様に回避の値の初期値なども操作する。
### 会話ウィンドウ
基本的にasciiローグライク風の画面を進めると
それに同期して会話画面の文字とストーリー画像が進む感じ
矢印操作の案もあったけどそっちは廃棄

### 死にかけの際のフレーバー要素
死にかけの時にカメラが戻ると一瞬道ノ下、あるいは左上に映る。時間でフェードアウトする。
- V neklidném světě je naše cesta pevná.
- 我们的道路不可能崩塌。
- Con đường là nơi các đường thẳng hội tụ ở trung tâm của 'vision device' của chúng ta.
### 話題システムのパクリ(ファミレスを享受せよ)
サイドオブジェクトと**同じ色**の矢印と英語での綴りで
同じ線を用いて今何ができるかが出てくる。
それと同時にUSERUI上で歩くの周りに似たような太字が出てくる。
==ファミレスのパクリだから話題を用いたり、何かしたり、アイテムを使った結果とかで、==
==話題は増える。==　あくまでサブのサブ要素。
#### コマンド例
- ビルブレイク（破壊、サイドオブジェクトはエフェクト後にバラバラになる）
### 逆ストーリの可能性
会話などを一切省き、
一歩の地点ごとに逆順のストーリが設定されていて、
最後まで行ってから、戻るボタンが読む、になるのでそれでストーリーが分かる。
この場合ゲーム中の出来事がそのストーリで語ることになるよ
### 逆文字収集
逆文字であり逆ストーリである。
一歩一歩でその変な逆文章を集める
これは[[#パズル]]と関連する？？
この際画像はボスの出る箇所と同期する。
==ならその画像の状況とボスをどうリンクさせるか。==
#### 会話
二種類ある
[[路人]]がエンカウントして戦闘する直前に話しかけてきたり、
マップ上のイベントで話したりする。
**あの世**と同じような途切れ途切れな文字出現音でunitaskで非同期文章

このツイートのような平体から元の
読みやすい文字に戻るようなテキストアニメーションにする。
![](https://twitter.com/120U1/status/1833794496217428015)
##### 汎用的な動的な会話
プログラム上から実行される、色んな瞬間に差し込まれるunitaskとかでの会話。
謎解きというかそういう大事な要素なら聞き逃さないように、
プログラム上のアプローチで何回か救済的に会話されるようにする。
##### 固定会話
電話または無線または看板で、特定のエリアに固定で立っている奴。
#### イベントシステム
各所で汎用的に潜り込む会話システムと違って、ステージを突破するために、
設けられた**イベント門**があって、
そういうのは特定の抽象化した概念のリスト化が必要だと思う。
- アイテムの使用
- アイテムの保持
- 

## 絵
**散開とか誰かの個人戦闘状態**のときとかに離人システムを表現するため、
==アールエス==の暗い画面での動く四角形とか、それを基本とした
少ない要素しか見えないアールエスのような背景絵

元々のあの適当雰囲気+　
![[簡易雑多#mohoによるキャラ表現または絵の雰囲気]]
動かすかも

#### 味方アイコン
**不動**、枠線もなし、
そこに色々攻撃エフェクト飛んできたり、裏に色が入って状況を(魂の開放とか)表したり、
アイコン自体にドットのエフェクトが滞在したりする？
前のめりを表すには==特殊な拡大ウィンドウ==でアールエスみたいに上下して別に映したりする？
ロックマン3か10のどのボスの機能をそのコピーロボットが使ってるか表すあれみたいに。

#### Canvasのシステム（最適化）
dynamicCanvasとAlwaysCanvasに分けることでuiImageの負荷を下げている。
また、CanvasごとにSpriteAtlasを設定している。
DynamicAtlasにはImageディレクトリのDynamicフォルダを直接渡してアトラス化の管理をunityが自動で行うようになっている。
https://siguma-sig.hatenablog.com/entry/2018/08/11/095156
#### エンカウント
**ボタンは既にある物の文字が遷移なく変更する。**
==糸がこんがらがるアニメーション==がEncountWaveと同時に発生して、
waveが去るころにループアニメーション(敵の)が出てくる感じ
#### 背景の構成

-  上の方に山のような遠景として遠く描かれる単純なディテール
	- これは一種のステージ系UIのようなもので、ステージごとに変わる
- WalkWeb
	- WalkWebをもっとサイドオブジェクトとロードオブジェクトで囲むに値する
<mark style="background: #FF5582A6;">進むべき先</mark>のような感じにする。
==アニメーションせずに手描き風にそのまんまでいいかも。==


普通にゲームの目標としての感じを思わせるようなのが重要。ただでさえ単調なゲームなのだから　キラキラきらんと。
アニメーションさせてもいいと思う。
ものすごいはっきりさせるような感じの。
都市としてのビジュアルなどサイドオブジェクトやロード、上のui枠で再現するから
真ん中の遠くにはだんだん大きくなる目標としてのビジュアルを。。
なお、
- ステージの終わりか
- またはエリアの終わりかで
 目標地点の絵は代わる
	- ![[Drawing 2024-10-07 04.46.36.excalidraw|200]]
- NoiseSea
- EncountWaveが外で待機
	- EncountWaveは灰色で白を埋め尽くすから、==敵の色は白色で描かれる？==
- サイドオブジェクト

#### 敵グラは
- スカイショットrpg式テキスト
- 精神、[[ディノイド]](それ自体が[[TLOAの傾向]]がそうなってるということ。)
#### 敵のアニメーション　エンカウント
登場時　→　ループ→==種別による==あの世のような汎用的な消滅アニメ
被ダメや攻撃などの敵アニメの違いは一切ない
![[#エンカウント]]

弾けるようなアニメーション
ループアニメが出てくると同時に
その背後に種別が文字送りで出てくる。
中央揃えでタイピング風に
また、文字には背景がある。見やすいようにね

#### 豚岬の景色
豚岬の景色は四隅を省いた画像を奥にした例のレイアウトのときに、**初期想起したあの景色をしっかり遠景に描く**  
#### エンカウントのフロー
- エンカウント時にスカイショットrpgとアールエスを混ぜたような絵展開
具体的に言うと図形で満たされた画面が元の背景画像をオーバーレイまたは
元の背景画像そのものをかき混ぜる様なあれ
- 四隅の欠いた遠景からノイズ満たされた周囲園域からモザイクのような効果音と共に出てくるイメージ  。初期の爆発円環のイメージはそれに付随する形で  （モザイクにイメージが引き寄せられる感じで）
#### UIアニメ
https://youtu.be/LxHX021vqyM
の二分あたりの新妻がズームするシーンの
絵の動く感じがいいから、音楽の入り感も再現しつつサイドオブジェクトや特定画面からの戻りなんかに使いたい
#### ステータスエフェクト
##### 雑多案
- https://youtu.be/LxHX021vqyM　二分あたりの目が光る単純なのをそれぞれのアイコンにそのまま　2つを適当な位置でフェードする。　効果音も近く　でそれ自体を何らかの調子のいいワンアクション起こすような状態で表すのに使う。

#### スキルエフェクト
全体的にlitmotionを用いた
アンディーメンテ式か、
または普通になんかの絵か
**ターン事に消えていく薄い矢印で攻撃の方向を示す**
フェードアウトをターン事に少しずつにすることで、誰が誰に攻撃したかの指標を
ある程度振り返れるようにする。

[[円シェーダー1]]
[[赤い激しいエフェクト]]
#### 敵の攻撃エフェクト
eyearea左下の主人公陣営のちったい四角に
敵のエフェクトは来る、
その**小ささに合わせたミニマムなエフェクトで表現する。**
#### [[思え鳥]]のエフェクト
敵の場合、キャラテキストの近くに概念的下手な絵があるが、
そこにある心っぽい部分の絵にひび割れていく感じ。
味方の場合、四角のミニボックスが割れるだけ(割れ目から
それぞれの鳥が見える)
[[思え鳥]]になると、USERUIのmainでの各キャラクターの絵が
それぞれの鳥になる。　派生鳥(サテラ)の絵もある。

#### ~~数字~~による槍展開的なダメージエフェクト
あくまで**あの世**風なテンポで進む話なので、
**このエフェクト表現は後発的な攻撃または**
**そもそも使うとしても超高速で展開される?**
[文俊 さんのノートブック](https://1drv.ms/o/c/0a9d605a6bc4f019/EhnwxGtaYJ0ggAp3WgAAAAABKMDhfXAGH1FrvpkCaOeDKw?e=FOnSpd)
![](https://twitter.com/FigsFromPlums/status/1836163226284798038)
#### 背景
[[豚岬#雲の世界]]に準ずる
## エンカウント
ボスの際は[[evilsearh]]をクリアするまではランダムでエンカウントする。
### エンカウント率
**cutareaごと**に一つ統一で決める、
敵リスト
### エンカウント処理
#### 倒した敵の死亡処理(非エンカウント処理)
エンカウントした敵がエンカウントしないよう登録するには
勝利した時に　　
元のstageデータベースに登録された敵を参照して、それをplayerstatusで
deadlistとして登録出来るようにする必要がある。　(idとか付与すればそれ比較で余裕か)
==ScriptableObject==の_enemyListを関数由来で変更、普通に別クラスから変更できるらしい。
その処理は敵の**種別**によって変わる→[[#復活の違い]]
### 敵集まりAI
数、組み合わせなどを属性、種別などの要素で決める。この結果が**パーティー属性になる。**
- 味方待機リストにサテラがいない場合
  ホッチキスは絶対にエンカウントしない。
#### 敵が一人の時のパーティー属性変換(キャラ属性→パーティー属性)
NormalEnemyのソースコードにある
#### 種別同士のエンカウント相性
NormalEnemyのソースコード部分
#### 属性同士の固定組み合わせによるパーティー属性変換(二人以上)
[[#精神属性]]同士の固定的な組み合わせによる[[#パーティー属性]]。
これになかった場合、[[#キャラクター属性同士のエンカウント相性値の表(敵)]]で判断。
この処理は出来れば相性値のロジックで複雑かつ思慮深く敵の関係性をパーティー属性で表したいから、==出来る事ならしたくない処理==,つまりここに**羅列されるものは相性値での算出結果としての目標でもある**。
- サイコ、シークイエスト、リーミナルホワイトタイル→オドラデクス

#### キャラクター属性同士のエンカウント相性値の表(敵)
##### 表のルール
- 列（1行目）の属性が**感じる側**、行（a列、一番左の列）の属性が**相性を感じられる側**として、それぞれの相性値をセルに入力します。非対称な相性値を持たせるため、行と列が逆の位置には違う値を入力します。
  例　リーミナル→キンダーガーデンの相性値はb3セルに
  キンダーガーデン→リーミナルの相性値はc2セルに。
- 同一属性は感じる側も感じられる側も同じだし、表の都合からいっても、一つだけ。
- 相性値は**感じられる側**を同じパーティに入れるときの判定なので、**百分率の数値**を入力。(integer)
##### 相性表(スプレッドシート)
https://docs.google.com/spreadsheets/d/13ri50fcdn-ikmkgt3gj9B5R9MLfwCZqgdozH3I7h1Pk/edit?usp=sharing

## メイン戦闘時ループ
~~あの世のように時間空けて敵の攻撃も実行される感じ?~~
スカイショットrpgのように>>を押して進む感じ。
後はキャラクターが選別される特定の戦いやその間離れてるキャラのエンカウントタイミングと
その瞬間の離人システム複数戦とか、そのタイミングを含めたの戦闘ループの設計調整が大事
→[[戦闘雑多]]

### 基礎計算
- agiは回避率だけでなく単体攻撃にも命中補正がかかる
	- 広範囲攻撃には意味がない。
	- 暴断だとagi命中補正は半減するが攻撃agi補正もかかる
- 前のめりしてると回避率半減する
- 命中判定は　命中に補正を掛けて、対象者の回避と合わせて判定
  ＋　スキル自体の命中判定
	- atkの場合はどちらも　healの場合はスキルの命中判定のみ
- (攻撃-対象者の防御　) ×スキルパワー？
- [[#回避率]]で述べてるように　スキル依存の回避率がその後のターンで続くが、
  広範囲攻撃(広範囲として実行したとき)の場合はスキル依存回避率が減る
- スキル命中率が50に近ければ近いほど、前のめりになるスキルで、後衛から前のめりになり、追撃が発生しやすい
	- また、この仕組みは**ファイアーエムブレムの実行命中率**を採用する
	- 特定の精神属性への相性がある。
		- 追撃を確定回避
		- または確定カウンターされたりする。
### 自動攻撃増減
特定のターンが進むたびに、
自動で攻撃力が上がる。　ぽれんのパクリ
### 慣れ補正
[慣れ補正-chatgpt](https://chatgpt.com/share/67591054-1390-800e-94c2-24542c7fced0)
[[慣れ補正のラフ案]]

#### 下限しきい値
[[CalculateEYEBasedAdaptThresholdのchatgpt]]
#### 優先順位
そのスキルから受けた**最大ダメージ**による序列などで、
慣れやすさや忘れやすさが左右される。
区分けというのもあり、
優先順位の**序列の分け方**を精神属性によって変える。
以下の表の区分け方式を元に、
==単純な序列が==変換される。　
それぞれの計算結果によって編み出された、
**序列の数を<mark style="background: #FF5582A6;">慣れやすさ=記憶回数の増加</mark>や、
<mark style="background: #ADCCFFA6;">忘れやすさ=記憶回数の減少</mark>などの計算式に含めて計算する。**

| リーミナルホワイト | キンダー | 自己犠牲     | シークイエスト | デビル | ドレミス                       | 支柱  | ゴッドティア | ベール      | サイコパス |
| --------- | ---- | -------- | ------- | --- | -------------------------- | --- | ------ | -------- | ----- |
| 素数        | 乱数　  | 素数と乱数の交互 | 十進数     | 省く  | 最初は六つ固定で区切る。<br>その後は七つ区切り。 | ５ごと | 6ごと    | 3以前とそれ以後 | 省く    |
#### DEFによる基礎減少値の仕様
[chatgpt](https://chatgpt.com/share/67591054-1390-800e-94c2-24542c7fced0)
- 例えば0.7が無補正の値、0.2などが究極の補正値？　０までは超究極に下がりにくい？
- DEFが多ければ多いほど、基礎減少値は補正され縮んでいく。
  だからその補正されるDEF自体の限界点を定める必要がある
	- つまりDEFの1,2,3と増えていく数をそのまま基礎減少値の減少補正の計算に使う感じ

#### DEFによるスキル記憶回数の減少
DEFによる固定値と優先順位を計算して、どのくらい減るか　
優先順位が低ければ低いほど、つまりfinalSkillRankが多ければ多いほど、記憶回数が減りやすい
- 優先順位は　**単純なindex**
- DEF固定値は再行動までのターン数を加味した1以下の小数
- 経過ターン はただの経過ターン、だけど**この平均的な想定の数を考えてDEF固定値は設定されるべきだ**
- 記憶回数 はそれの最終計算結果にかける感じ　三分の一減衰　ソースコードに詳しい詳細あったはず
- DEFでどう記憶回数が減る数字が減るか
	- <mark style="background: #CACFD9A6;">記憶の落ちこぼれ</mark>は、==その時食らった**以外**のスキル全部==
	- 前回からの経過ターンでも　例えば1ターンごとに<mark style="background: #FFB86CA6;">0.3回分</mark>減る
	- 記憶回数が多ければ多いほど、減りにくい
		- 単純な１グループ内での**位置**で割合が返り、
		  その割合の半分から三分の一の確率で、減る数が三分の一に減衰される。
	- 優先順位が関係する？　**DEFから返る**<mark style="background: #FFB86CA6;">固定値</mark>
		- 優先順位が低ければ低いほど減りやすい。
		- 優先順位での減り方も含めて<mark style="background: #FFB86CA6;">固定値</mark>で返すようにする。
			- 優先順位　×　<mark style="background: #FFB86CA6;">固定値</mark>　みたいに。
#### DEFによる記憶回数の増加　　記憶。
優先順位　×　DEF固定値(基礎上昇値)　　+ 記憶回数(の多さ)による微補正　経過ターンが特定の数より少ないとその分＋？
- 優先順位の序列でどう回数が増えるのか。
	- 記憶回数の増加は、==その時食らったスキルのみ==。
	- 優先順位による値(忘却時と違い、序列が下がるごとに値も減るので、そのまま掛けられない)
		- 最初の一軍は二回　減るごとに1.1みたいにfloat端あまりみたいになっていく感じ
#### 慣れ補正の計算
- **EYEによる基礎量と記憶回数と記憶段階を掛けて1から引く**
	- 大前提として　==0.85～特定の値(EYEによる微増数) を最大限に　小数で補正する==。
		- [[CalculateEYEBasedAdaptThresholdのchatgpt]]
	- EYEの値によって、<mark style="background: #ABF7F7A6;">固定値</mark>が返る。
		- 小数0.0004単位？　ここの**単位調節は1バトルの長さと密接に関係すると思う**。
		- **ソースコードのSwitch文で直接入力**←HITから返る<mark style="background: #ABF7F7A6;">固定値</mark>
	- 精神段階は<mark style="background: #ABF7F7A6;">固定値</mark>に掛ける
		- うすいで1.42倍　普通で3.75倍　濃いで十倍？
### 先手後手
先手を取った側が三回行動できる。
この際recovelyTurnはない。

#### 切り返し
もし後手にゴッドティアかキンダーガーデンがいた場合、
先手三回目の攻撃が40%の確率で後手のキンダーガーデンかゴッドティアに取って代わられる。

### 精神属性による補正
https://docs.google.com/spreadsheets/d/1T5fNCG2i5AIs87pdG9JBl8G_15lC8nAPKZfdyDUOQfA/edit?usp=sharing
### クリティカル
クリティカル
### 乱雑する力
rpgフレーバー　乱雑する出力または乱雑する力  
攻撃のときにたまにランダム化してしまうがその代わりそのランダムの最大値が通常より大きい？  
つまりクリティカルの色違い？

### ぱーてぃか(運命の回転？)
#### 概要(発生条件)
**20ターンに1回、または誰かが死んだときに発生する。**　パーティー力。
**全体同士でラグビーみたいにスクラムするターン** 
であり、その発生条件の際に、==**お互いのグループが二人以上いないと反応しない==。**
戦闘開始時にお互いのグループに(ここでも二人以上判定がある。)50が上書きされる。

もし二人以上いるのに他が死亡判定になった状態で一人の状態から
→復活スキルで復活させて二人以上に戻った際、そのグループに50が上書きされる。
(<mark style="background: #FFB86CA6;">瀕死状態での決死の行動に捧ぐささやかな運命の動き</mark>)

#### 判断基準
彼らのぱーてぃか(数字)を比較し、
10以上数を超えて多い方に、報酬がもらえる
#### 報酬
[[#ランダムなターン制]]で  やや優位性がつく。
#### 意義
集団戦において、風の吹く向きが彼らの方向が変わることで影響される様子を
再現したい。
#### 敵のぱーてぃか
全員の**強さの連鎖**、HPで定義。
で上から並べて上から数えたときの、相性値(三人なら二つ、二人なら一つ)
で決まる。HPの定義はその時のHPです。(最大HPでも微妙に補正されるが、)
その**コンディション値**のHPの組み合わせによる全ての値を
並べて、それらと比較した際の度合いによる真ん中を境にした百分率の計算で、
ぱーてぃかが変わる。(60なら10上がり、40なら10下がる感じ)
##### 変動するとき
敵のぱーてぃかの変動は、敵のどのHPも88%以上でないとき、(この場合3ターンごとに+2)
また、同じHP+-4%でないときに。(この場合毎ターン+2)

つまり[[#敵集まりAI]]での==相性値はBattleGroupに保存==出来るようにする???
#### 味方のぱーてぃか
同じようなスキルを使い続けると、ぱーてぃかが下がる。
違う種類のスキルを使うと、ぱーてぃかは維持される。
その時と違うスキルに、ランダムターン(出ないターンもあるということ)
でぱーてぃか推奨スキル(運命補正の表示??)が映ることがあるので、その推奨スキルを使うと上がる。

### 戦闘最大人数
味方:最大3人(離人システムに応じて変わる)
敵:最大3人　(TLOAの性質と前のめりのできることを考慮すると、
この数がいい。)
敵同士の集まり方はそれぞれ個別に考える。
### 銭湯終了時のHP自動回復
離人システム含め、すべての戦闘が終わり歩行状態へ
移行する際、ターン数と食らったまたは与えたダメージをもとに計算して、回復する。?
==歩行しながら回復する？==(歩行passiveが与えられる形で？)
### 回避率
戦闘初めは全員に基礎回避に加えて、初期ボーナスが与えられる(基礎回避依存。)
**初期ボーナスの効力は自分のターンが行使されるまでで**、
それ以降は普通にスキル依存の回避力になる。
具体的には直前にしたスキルの回避力が次まで続き続ける。
だがターンがたつにつれ元に戻る→[[回避率の平準化]]

**回避段階に応じて==強制散開が発動==?**
完全回避(ノーダメージ)
かすり(割合少ないダメージ)
Hit
クリティカル(大Hit)

強制散開条件は
全員かすり以上なら
つまり上の四つの列挙体は**数で制御すれば処理が楽。**

かすりとクリティカルは同じ確率の2分の一??
### ランダムなターン制
確率がだんだん低くなる三回まで連続で選ばれる事がある。　
上に指標などを入れて駆け引き要素なども考えたが、**分からないように次の行動への何の指標も入れない。**
### 逃走率
エリアごとに決まってる
ボスとのきだけ+10%する
### ダウン
連続で攻撃を当てたときに、
ソイツのダウナーカウンタがゼロになったら、
ダウナーカウンタの半分　だけ、
ターンとして選ばれても何も行動できない。
追跡エネミーの場合はダウナーカウンタは
三分の一となり、ダウンさせると確定で逃げる。(強制)
### 散開と追跡システム
散開時のエフェクトはまずunitaskで散開エフェクトが終わるまで待って、
それから簡易マップのnowimgがスターダストみたいな効果音と拡大フェードアウトエフェクトで
消えて、赤点が周りに散らばってるって感じ。

追跡はいわゆる残存システム  
零　追跡はない　~~1一定時間集合不可~~  
二　散開したときに低確率で誰か追いつかれる

散開をした敵は次に散開して入れ替わるまで、
エンカウント率が超低下する。
**散開時はprogressは変わらずに固まり、その場の地点から**
**三点の赤いのが現在周辺から適当に散られる**。
ランダムで戻ってきて、現在地描画地点にある一定の大きさの
当たり判定の円に入ったらそいつから収束する。
収束するまでに逃げた敵以外のと逢ったりする。

==散開をさせてくる攻撃もある(即死レーザとか)==
### 幻覚効果  
月が見えるとその次の効果は皆にとって恐ろしいもの  
（散開ならバラけ方とか、離人戦闘ならそれとか、スキルなら単純に効果とか）  
[[天使の輪虫]]が見えると自分の次が素晴らしい効果。  
[[新生悪魔鳥]]だと自分に即座に良い効果が出た後に、  
敵にも確率で良い効果を満たすかも。  
（敵味方両方）
### 離人システム
複数のこじんせんなどがそれぞれの速さや  
回避率に応じて同時に展開される  
当然影響はしあわないが緊迫感がアル。  
  
これを散開時個人戦闘または  
誰かが個人戦闘中に発生するかも
離人システムによる二人目以降の戦闘では
優位的な先手後手の判定はお互いにない。
### 命中
基本的に百パーセントだが、
**スキルの命中率**によって変化しつつも、
- 前のめりをしない攻撃
- 前のめりでないものを狙う攻撃
の際に、それぞれ低く補正される。
### 回避
スキルの回避率とAGI依存？
肩代わりとかは**スキルで実行すればいい。**
### BaseStatesuと攻撃エフェクトの同期
例えばatk関数にエフェクトと実際に実行される攻撃処理があって(r3でサブスクライブ？)これにターン数などを実行しmanager等で登録する形にすれば、後発的な攻撃の表現をエフェクトと一緒に実行できる
(ボタンを押した際に展開されて、atkがターン経ってから実行されると
エフェクトがアニメーションし消去? )
uniTaskの条件待ちでも行けると思う。
### 攻撃の当たり方
==基本的に前のターンで攻撃した奴が前のめりになり、次のターンで攻撃を受ける。==
前のめりはしなければ基本的に前回の前のめりが持続する。
### 前のめり
~~最初の前のめりはランダムで**お互いグルのープからそれぞれ一人**選ばれる。~~
前のめりが誰一人
ない状態によって対象者選別などの処理も変わる
#### 攻撃対象者例外
[[拳銃限られた銃弾]]は敵を選択する。(威力に違いはない。)
[[絶神術]]は全体攻撃で、後ろにいる奴のが食らう。
#### 前のめり例外
[[絶神術]]は指クイするから、前のめりしない。
[[拳銃限られた銃弾]]は前のめりを選択できる。前のめりした場合命中率が一律になる。
しなければ後ろの奴への命中率は半減する。
**それ以外は前のめりしないとダメージ与えられるわけないだろ。**

## ステータス
### 運用ステータス
レベルアップはせず、~~各ステータスがそれぞれ条件で上がっていく感じ。~~
歩いたりステージ進んだだけで上がったりもするかもね。
==永続的に上がったりすることはなく==、いわゆる運ゲーなのかもしれない。
**ただしHPだけ半端にちょっとずつ上がっていく。(経験値以外のシステムで)**
攻撃に命中などは**スキル依存**
#### 共通
##### HP 
ハイヤーセルフというスピリチュアル用語が元ネタ
この場合のハイヤーセルフというのは二つあり、
1. [[データベースとシステム(アルテミス|データベースとシステム]]
2. [[アルテマルフト人物構想機械]]における[[ポインタ]]
これに連なることを言っている恐れがある。
**HSPV**：**Higher Self Pipeline Value**  
高次の自己に関連するパイプラインの値を示す略語。例えば、キャラクターの精神力や魂のレベルを表すシステムに関連して使うことができます。
##### P (キャラごとに複数あったりする?)　

##### 名前の由来プロパティ（フレーバー要素）
##### 印象の名前
裏に出す名前
##### 名前
おもてに出す

##### リカバリターン(一回攻撃した後に、次のランダム敵選択リストに入り込むまでのターンカウンター、前のめり状態だと2倍の速度でカウントされる。)
#### 人間(種別)
気力(TLOAそのものではなく単独で動き、TLOAを展開させているから、
逆にビルから発生してるTLOA達はビルのエネルギで気力は常に補給され続けてるから、
TLOAそのものは一定。)
 実態生命
人間状況,、思えの値。

#### 新設悪魔部隊
HP経験値(歩行で溜まっていく、**逃走するたびに減っていく。**
それ以外で戦闘を終えても増える。)

### 特殊プロパティ
##### 飛行
##### 追跡
==**プロパティではなくPlayerStatesuに登録されるもの**==
==**として考える?**==
### オーラ系
炎のオーラとか、みたいな明らかな上書き属性。　弱点が存在しない。
[[正当な廃都市]]ステージだとやばいくらい強い敵だけど、
[[#豚岬]]のステージだと割りかし当たり前に出てくる。（悪魔多いから？）
ただし、豚岬だと今まで倒した敵のTLOAが使えるので、それでTLOA2 科学の鳥によるTLOAの物質的融合による強いアドバンテージでゴリ押す感じになる。
### 種別
#### 人間(実態生命)
**人間状況**がある。

#### TLOA
- [[ライバハル(TLOA)]]により、戦闘内での**一時レベル**がそのスキルに
  限り、増えていく。
	- 要はアンディーメンテの熟練度システム
- ライバハルは人クラスで増えていき、つまり一つのスキルというよりは==ライバハルのの上がったTLOAカテゴリのスキル全般って感じ==

#### 機械


#### 人間以外の実態生命
人間と違う点は、**人間状況**はあるが、低レイヤーになるに応じて、
人間状況のカテゴリが基礎的なものしか存在せず、(==完全体rpgの性格天気補正みたいに全部に設定するか、クラスの継承で体系的に実装する。==)
さらに**思え**の値も知能が低いほど、最大値がクソ高い。(めったに[[思え鳥]]化なんかしないわ)

### 人々
種別などでは決して分からない実際の傾向をまとめる。
つまり==派生クラスなどによる独自実装==
→[[#敵]]


##### TLOA PHANTOM
TLOAの部品というか、[[正当な廃都市|閉都市]]におけるTLOAに似た[[科学]]物質
##### 半壊TLOA
[[蝶に占拠された電さい門の辺り]]にしか出ない
##### アサルト機械
##### サブアサルト機械
### 状態異常
そのキャラクターに現在突起的に起きてる事。
**状態異常のクラスそのものに**
**適合するプロパティを作り、**
**それが合い、発動条件クリアして渡されたら発動。**
つまり
- 発動条件(攻撃とかイベントとか)
- 相性条件(属性、種別など)
#### 歩行効果と戦闘効果
歩行効果は文字通り。
戦闘効果はターンごとに
#### バリエーション
##### ALL
- 延焼運命共同体　←キャラクター同士の状態異常？　これあると同時に起こる？
##### 新設悪魔部隊固有
＜オンケレイト>→[[リズミカル魂の開放]]
##### サテライト
<剝き出し>
[[思え鳥]]化する時に、たまに抵抗して、知能レイヤが下がり派生鳥の姿になる。
**スキルや彼女が関係する事柄などがすっかり変わる**(出来なくなる。)
##### 実体生命
<鬱病>
鬱病地区とかで移される。距離が延びる。

<思え鳥>
![[思え鳥#概要]]
### 属性
相関するというよりはそれぞれのスキルにそれぞれの耐性とか得意が設定できる感じ
つまりその**スキルを使えば使うほど、そのスキルの耐性にキャラクターが近づいていく**
また、属性ごとに人間状況に対する　精神影響の相性がある。
以下の細かい属性一覧は
キャラクターとパーティー以外は
スキルに依存する
#### パーティー属性
- 馬鹿共
- メレーンズ
- 聖戦
- オドラデクス
- 花樹

味方陣と敵陣の属性などの組み合わせ
で決まる　二つのチームがそれぞれ持つもの。
##### 味方の決まるロジック
<mark style="background: #FFB86CA6;">HPの組み合わせ</mark>で決める
この意義は?
→プレイヤーの選んだ選択によって、変化してほしい。
**ステータスとしての成長要素は最大HPのみ**だから、
全員万全状態でも差異が生じる。それでもパーティー属性は==現在HP==で決まるから、
ちゃんと状況による差異も生じてくれる。
#### 物理属性
種別または特殊プロパティまたは
個別で手動にこれに対する耐性を設定?
- ヴォ流転
- 床ずれ
- 暴断

#### キャラクター属性
直前のスキルの精神属性に影響
##### 敵の初期精神属性
敵の初期エンカウント時に**持ってるスキルからランダムに選ぶ関数**が実行され、
以降は倒された時とか逃げたときに保存されたままの
キャラクター属性が実行される。

例えば、**気後れ**なんてパッシブを持ってる奴なら、
このスキルが自らのキャラクター属性に取って代わるのが
2ターン遅れたりするかもしれない
#### 精神属性
攻撃対象のキャラクター属性と嚙み合う
これらの名前と文字色をゲーム開始時にランダムに決定するって案もある。
- リーミナルホワイトタイル
- キンダーガーデン
- 自己犠牲
- シークイエスト
- デビル
- ドレミス
- 支柱
- ゴッドティア
- ベールドライヴァル
- サイコパス


### 人間状況(実態生命全てに体系的に適用)
状態異常などで傾いたり、変わらないエリア固定値などによって変化したり、
複雑な値で決まる固定値

### 思えの値
**人間状況があるキャラのみにある。**
maxになると<[[思え鳥]]>化
**種別*など*のそのキャラそのものの知能によって**
**大きさが違う。**
==ぶっちゃけ手動設定でいいと思う。==
##### 上昇条件
人間状況に対する属性の通りやすさ
{耐性}人間状況　{攻撃}属性
**キャラ自体の属性は関わらない。**(キャラ属性VS攻撃属性はHPに対するダメージ)


## スキル

### スキル性質
#### スキル自体の性質
- skillType
	- 死回復、攻撃、回復、状態異常付与と除去


#### スキル範囲の性質
##### 重要なこと
- あくまで前のめりシステムで成り立つものなので、
  前のめり後衛の枠組みを超えた**、範囲も単体も指定できるものは存在しない。**
	- そういった枠組みを超えた攻撃は**ランダム性か全範囲性**でないと超えられない。
##### 性質一覧(ソースコードを見て)
- 完全ランダムで単体
- 前のめりか後衛か(ランダム)で単体
- 選択可能な単体
- 前のめりか後衛かの範囲攻撃
- 完全ランダムで前のめりか後衛かの範囲攻撃
- 全範囲攻撃
	- この場合前のめりと後衛へのpowerの割合が決められる。
- ランダム範囲攻撃
	- 全範囲または前のめりか後衛範囲または単体のみに
	  ランダムる
	
- 全範囲選択攻撃
	- 全範囲ならこのぐらい、前のめり、後衛、
	  単体ならこのぐらい、みたいに、powerの割合が違う？
	  それを味方ならボタンから選ぶ感じ？
	- これは選択可能な単体や前のめりか後衛かの範囲攻撃など、**色んな性質を一気に含めるとこうなる**？

#### スキル連続攻撃の挙動
- 毎回範囲が選べる(前のめりか後衛)
	- 範囲または単体で
- 毎回ランダムに範囲が変わる
	- 前のめりか後衛か決めた内でランダム
	- 前のめりか後衛もランダムで(全ランダム)
- 毎回対象者単体を選べる
- 同じ奴を攻撃し続ける
#### 特殊な連続挙動
- ターンをまたいで連続攻撃が進む。(フリーズ連続攻撃)
- ランダムな百分率でスキル実行が継続されるかどうか。
  (連続攻撃)
  - 保存性質
### メッセージについて
発行される文章は基本的に**ReactionSkillメゾット内の最初の方のスキル効果のみ**
何故ならそっちのが複数発行するときにnextwaitとかnextwaitボタン押したときに
それらの効果が発生されてその上でメッセージ出るようにするとかだるいから。
==基本的にATKとかみたいな文章が必要な奴が最初==で、
passiveみたいなみりゃ分かる奴はATKより優先順位が低くなる。(当然passive付与専用のスキルなら文章が出る。)
### スキル命中率、力、防御、回避の扱いについて
#### 命中率
スキル自体に**スキルパーセント補正というプロパティ**がある。
術者自体の命中率に==掛けて==使う。
#### 力
**skillPowerというプロパティ**を術者の攻撃力に==加算==して使う。
#### 防御力・回避
passive付与で補う。
### 精神属性
スキル自体にやどる精神的な属性
これを攻撃した相手の[[#キャラクター属性]]と
嚙合わせる。
### 物理属性
あるのとないのがある。
ない場合は物理属性自体の判定がなく、
精神属性だけでの威力決定が行われる。
### ＴＬＯＡ有無
これがTLOAかそうでないかで色々変わる。
### ターン系プロパティ
この場合のターンは**BattleManager単位で、死んだり生き返ってもリセットされない。**
#### 発動カウント
- triggerCountMax
	- 決められた分だけ連続で実行しなければ発動しない。これにより==**スキル実行**と**発動カウント中**の状態に分かれる==。
- CanCancel
	- 発動カウント状態を中断出来るかどうか。(スキル選択画面で別のスキル選択出来る感じ)
- ReturnTrigger
	- CanCanselをがfalseのとき、
	  別のスキルを選択したときの、<mark style="background: #FFB86CA6;">発動カウントの元に戻る処理</mark>。
		- 具体的な減り方とかは処理内で。
#### 連続攻撃回数と攻撃"*した*"回数
**スキル実行**のときに記録される。
- 攻撃"*した*"回数
	- doCount
	- 実行したら増える。<mark style="background: #FFB8EBA6;">死んだり生き返ったりしても、0にはならない。</mark>
- 連続攻撃"*した*"回数
	- doConsecutiveCount
	- 連続で使われた回数。違うのが使われたのが分かったら0になる。
#### 攻撃回数
atkCount
- 一回の実行時に何回**スキル実行**されるか。
  17回攻撃するとかそういうアレ seventeenWaysToHeavenみたいな
- **発動カウント**中は使われない(流石にここにもオプション付けたらこんがらがるし意味ない)
この複数回実行も当然**スキル実行**なので、doCountとdoConsecutiveCountは増えていき、
<mark style="background: #BBFABBA6;">それによりスキルの性質に変化があるように処理を書ける。</mark>
#### 同一スキル経過ターン
前回の同じスキルを使ってからまた同じスキルを使うまでの経過ターン。
<mark style="background: #CACFD9A6;">何に使う？</mark>
### スキル案
- [[着火]] 　[[魔素７２分割]]で貴重なため敵限定　味方はマ体のみが魔法スキル
- [[#雨光槍]]　雨が降ってるときに使える。
	- 雨の中で光を激しく反響させてレーザーを打つ
- [[パポンスター]]
- クレースアンドゥ　クレースアンドルフォ　畏怖クレースアンドルセ
	- 普段後衛で前のめりにならない弱い支援や攻撃スキルのみのhp低いキャラが、
	  たまに前に出て使う高い火力のスキルの体系
- RPGH rpgヒール　rpgのような瞬間回復
- 基本的ヒール　基本自然回復を付与する形でないと出来ない　
- [[エゼキエル]]　アイテムの銃で次のターンで確実に殺せる
- tab アイテムを盗む（形に結果としてなるTLOA的な）のを実装すれば、エゼキエルがスキル誘発される前に、敵の二分の一を削れる銃弾が使われるきっかけとなる。
- tab エゼキエルは映画のイベントコマンドまたは**前口上で何かを言った後に攻撃またはトドメを指したら、**スキル誘発される。　キャラクター全員に思い浮かぶ

[[セスナ]]
### パッシブスキル([[#特殊プロパティ]]に移動推奨)
多分ほとんど実装しない、
理論論理の為だけかな。

[[安定海の理論論理]]
### TLOAの相性
例えば[[安定海の理論論理]]（パッシブスキル名）ってのがあったとして、**彼らは[[TLOA]]を知っているだろうから**、（詳細はリンク先）
例えばあるtloaが[[量産型TLOA]]だったら、
それに対し、「量産された思考が真の思考に勝てるはずがない」と信じ切ってるキャラに対する攻撃はかなり半減される、みたいな？

==つまり完全に個人的なあれだからユニークな実装が必要だわ==

## アイテム
### 武器系（これいるか？）
これらは使用すると武器枠を上書きする。
#### サンミのロッド　
武器枠がサンミロッドになる
#### [[フライアウェイ]]
### [[拳銃限られた銃弾]]
三人のキャラそれぞれのがあるので、
戦闘するときはそのキャラじゃないと使えないし、
通常時に使ったらその拳銃の弾だけが減る
<mark style="background: #FF5582A6;">アイテムではあるが専用の使用ボタンを各スキル選択画面に、アイテムとは別枠に設置する。</mark>（使いやすいようにするためなのでアイテムから使用するのと同じ）

## 敵
敵はシステム上ステージのデータにリストとしてに蓄積される。
クラス的な傾向の案は[[#人々]]にまとめてあるが、
基本的に[[#ステージ]]ごとにまとめたファイルにある物に従おう
### [[#種別]]ごとの違い
#### 復活の違い
ただ一人=敵のシステムは回復地点と相性悪い。
だから**復活するかしないかの種別で分けたり、リスト内で意図的に重複させて**調節すればいい。

TLOAのキャラクターは一度倒しても消えない。
生命キャラは倒したら消えるが、特定の歩数で復活?

機械キャラは倒したら消える。
**結局敵の標準クラスに復活歩数プロパティ付けて
調節するから手動**
未復活の時はStageクラスで未出現リストに入れて
歩数処理すればいいだけ。　[[#倒した敵の死亡処理(非エンカウント処理)]]



### 裏切り
主人公はラスト
マ体はマ体の暴走(左半身消失)
~~同僚は思え鳥化~~([[思え鳥]]は全員?)
### 敵たち
==**実際はステージごとのメモでまとめてます**==→[[#ステージ]]
#### [[路人]]
倒した際にそいつらのhpは自分にくっつけられる。回復しない最大hpとして。
**主人公単体戦**で、下手したら他の敵と全体戦中に茶々入れてくる時もいる。
#### ホッチキス(追跡残党)
**同僚単体戦**　周りの二人は逃げる
ホッチキスに乗って襲ってきます
三人乗りホッチキス
　四人乗りホッチキス　人数効果で強さ、一人乗りが一番強いけど
　==こいつに会うたび同僚関係の深堀会話が進む???==
#### 悪魔に使役される武器のTLOAの奴ら(汎用強敵)
敵　首に剣が刺さってて、**抜いてそれを使うのが変身扱いで**  
**グラフィック変わる奴**　  
こういう感じで武器のTLOAがたまに出てきて、  
それぞれ剣人　槍人　エフィリー人(視線攻撃)　四つ足機械人  (床ずれ防御高め)
全員首からそれを抜く人体である。(豚争い　敵の章に書く  
豚岬では極魔道式敵グラ退陣はしない

#### 雪だるまのTLOA小
第一ステージで雪がやまない際の原因
倒すと永遠に降ることはなくなる。
#### 禍つ明のTLOA
持ち主の男の名前が強すぎてTLOAの名前すら消えてしまったTLOA


## 雑多システム
[[リズミカル魂の開放]]
- 逃走確率は確定40%
- セーブは[[ノーツのTLOA]]から随時行えます。
##### あの世と全く同じアイテムシステム
##### hddを重くすることで使えるアイテム欄
![[簡易雑多#hdd（ヘヴィーディスクドライブ）]]
この仕組みというテキストを元に、
重量が重ければ重いほどアイテムに物を入れられていくような感じで。
あの世と同じように使用はターンなどに制限されず、限られていて使用効果も少ないものなど。(==あの世みたいに枯渇すると死ぬエネルギーはないよ。散々要素たくさんあるけど。==)

これらアイテムは[[正当な廃都市|閉都市]]から生まれたアイデアがそこら中を
[[天球インターネットワーク]]の要領で浮いたりしてるって言う設定で、
TLOAが強く固まりやすいみたいなあれで、アイテム化している。
**PlayerStatesで管理**
##### スキルボタン系ui遷移
ランダムターン制であの世みたいに全員のスキルボタンが戦闘状態でなくても常に出てて、
それで空振りもできる。(**Pを消費するなら当然消費します。**)
外で振っても意味あるかも。

この機能の目的
[[リズミカル魂の開放]]であの世では剣ボタンがそのまま光るけど、
それをこのゲームでも実装するためと考えたが、別にキャラクターステージステータス光らせればいけるかも

**EyeAreaにあるキャラクターのアイコンがあの世の剣に互換して光る。**
~~USERUIのとこの各人のスキルも点滅?~~
USERUIのところは**雪道のboss時の表示みたいに**、太い字が絵の上にあるから、
~~それが元ネタと同じように震える~~。userUIは常に動いていてほしくないから、
==**{スキル名}(解放中)　って感じに()が付与される。**==

USERUIのボタンは雪道のboss太字風だが、　周りに円みたいなの書いて範囲を表す。

##### ステージ間の雪道風ストーリ
[[正当な廃都市|閉都市]]の完成するまでのストーリ入れる?????　[[豚のシナリオ]]
==または全体的な主人公当たりのスケールを飛び越えるようなストーリ==
最初だけイントロ? [[信仰型TLOA]]と[[量産型TLOA]]の違いとミサについても???いやそれは会話内容に入れるか???
![[豚岬#二百年チップ（仮） と 正当な廃都市 の生み出された経緯]]
##### パズル
次にエンカウントするまでに、**パズル**を解いて、防御力の低下を防ぐ。
防御力自体は戦闘すればするほど高まっていくが、(防御発生確率?)
歩行するごとに下がっていく、それを**パズル**で上げていく。
高確率ランダムで現れる道端にあるパズル要素を解いていく。
==アイテムがいっぱいあるほど有利になる。==
アイテムにパズルのヒントや、そもそもパズルの分かりやすさ＝持ってるアイテムの数や内容に
寄るようにするといいかも。
[[#逆文字収集]]で行う？
##### 歩行速度
歩行する速度が速ければ早いほど、**先手を取る確率**が高まる。
蓄積しない。(==明記しないシステム?==)
## プレイアブル
挙げられている者たちはあくまで**カテゴリ**それぞれの中に複数のスキルが内包されている。
#### 主人公
[[TLOA汎受性]]、[[拳銃限られた銃弾]]、[[武器主六面の魂]] 、[[恋愛兵器CZ]](弱いランダム攻撃?)
#### マ体
連鎖的な[[述]]([[絶神術]])　[[拳銃限られた銃弾]]、ミサ(TLOA)
マ体で肉体部分死んでも死なないから、このキャラだけは肉体が死んでも一部の技が使えるし、
全滅したらこいつが連れ戻す。
**物理技で二分の一で食らわない代わりに常人の二分の一しか**
**HPがない。**
魔法を食らったら彼の弱いマ体など即吹き飛ぶが、
うれしいことに本作はそんなキャラおらんから、平気。
##### ミサとは
**パズル要素**　兼　通常攻撃


#### 同僚
ワープ術(ストレイクト,)　 [[拳銃限られた銃弾]]　[[パーソナルイドラクト]](ホッチキス戦の時のみ)

## ステージ
[[正当な廃都市]]→草原→豚岬
休憩地点がそれぞれあって、それぞれに絵があり、
さらに休憩地点で区切られた通常のゾーンごとに、絵の違いがある。
### 流れ
#### 第一ステージ
蝶のステージ　[[蝶に占拠された電さい門の辺り]]
背景のでっかいシルエットの蝶がボス
コイツのせいで[[正当な廃都市|閉都市]]には入れない
ちなみに普通の蝶だから周りのTLOAは関係ない。逆に言うと人間が少ない、蝶に対処できないからね。

歩きながら攻撃するのがミソ？
出来るようになるのは[[evilsearh]]の判断で？
### 休憩地点
#### 魔式陣の展開
マ体の再生するには 以下のような**魔式陣の展開**が必要ですよん
[[魔素７２分割]]が起こってるからね。
![](https://twitter.com/DannyDrinksWine/status/1825977351190229101)
### 仕組み
ステージは分岐前とか分岐後の分かれ目数本で**エリア**として分ける
プログラム上ではStageCutとして。
このStagecutにlistでAreadataをまとめて一歩一個ずつ解釈する。
そのareadataに選択肢のデータとしてエリアのIDを指定し、
そのエリアに移ったりできる。
### ステージステータス
新設悪魔部隊たちの、**ステージステータスボーナス**
これはHP以外の全ての値に適用される。ステージごとに違う。
逆に言うとステータスはHPしか上がらない。

### 鬱病地区
雪の剣の影響で[[正当な廃都市]]の鬱病地区があるが、そこで鬱病のTLOAに伝染すると、
ノンフィールドrpgとしての距離が伸びる、直ると距離戻る。
つーかまぁ鬱状態直るまで永遠フリー歩かされて、解決するといつものステージシステムに戻る感じ、**特定ステージでの永遠解消までのシステムが大事ですわ**

### 豚岬
多分倒した奴のTLOAを使って攻略する。
オーラ系がクソ多いと思う
### クリア後
[[アーチの悪魔]]を倒すと、
[[魂的な逆行]]を手に入れたって出る。
![[豚岬#主人公が エディアカラ に書かれた展開。]]
アイテムを利用すると、
**ゲームはスタートから再開される**。
### 休憩地点
HPや銃弾の全回復、[[ノーツのTLOA]]の使用
(銃弾の全回復には色々条件等あるかもしれない。)
### 現在地点
散開時に花の画像に切り替わったり、
歩いて先手が取れる時間の間に点滅したりとかする。
## 天気

### 雨
#### 雨光槍
- 光のオーラ系を持ったユニット
- 光要素のあるユニークな技
のどちらは単独または併発で
雨光槍を打てる
#### 超絶雷雨
## 設定項目
#### 会話無効
ストーリー上、[[路人]]とかの会話要素をすべて省く。
会話イベントを全て一つの完結するクラスで扱った上で、
この設定は使えるようになると思う。
## 最適化
[【Unity】TextMeshProの容量を指定した文字だけ入れて減らす手順 - はなちるのマイノート (hanachiru-blog.com)](https://www.hanachiru-blog.com/entry/2021/05/27/120000)

## 宣伝
https://youtu.be/2ZlGtOqFDwA?si=rdxfqeireXaVJODk
これみたいに自作自演で
変なゲーム発見したからプレイしてみたって初見風の反応を**高クオリティゆっくりまたはボイスロイド動画として出す。**

## ゴミ箱

### 敵のpartydeathのタイミングに限りrecordedDeathを利用することで
複数回攻撃で毎回打ち終わるまで待つ感じにしようかと思ったけど、
ずっとやってるうちに百パーうざくなるからなしで。
==でも==複数回攻撃中にはrecordDeathをしないことで、
特定のブレ範囲にすでに死んだ敵が入ることそのものが戦略性のランダムになるから、
複数回攻撃においてはrecordedDeathは意味がある

### これは別ゲーのエンカウントロードシステムとして使おう。　例えばツクール系とか　#RPGツクール 
視点切り替えは上から見下ろしたグネグネの道を
敵戦闘の並び順に上から並べて、
それを道の部分をスクロールブラーさせる感じ。
つまり最初のエンカウントで**そういうグネグネの道に切り替わりズームアップ**する必要がある。
### ランダムターン制とオーバーキルによる機械完全破壊システムは相性が悪い！
~~機械であり、復活可能なら~~
~~death後にオーバーキルポイント分攻撃しないと~~
~~復活するが、逆に言うとオーバーキル分攻撃すると、~~
~~復活不可能体同様にbrokenする。~~
~~**つまり機械は復活可能でも実質永久に壊せる**~~
却下した理由は
前のめりしてる前衛とその後ろにいる後衛を
<mark style="background: #FFB8EBA6;">基本的に激しい駆け引きのさなかでなんとか
選別して戦うっていう様子を表現した上でのランダムターン性だから、
意図的に死体に打ってる暇あるの？って話。</mark>
多分死体は後衛になってると思う。
メタ的には生きている人間の後衛を選ぶと**前のめりしてる奴のプレッシャーで**
二人にぶれてどっちかに当たるが命中率下がるってあれだから、
それが死体になった瞬間に死体に当たるか生存者に当たるかとかでぶれてってきもくね
ってかそもそも==ランダムターン性自体が色々小競り合いをしたうえでの==
==**ゲームシステム上大きく見えるHP上下はこんな頻度だよ**ってあれだから、そこに==
==死体狙ってるってノイズが走ると、その<mark style="background: #FF5582A6;">HP上下による都会戦闘感とのSyncが途切れる</mark>気がする。==

### 戦闘時の画面移行についての思考
つまりフラットなのがノンフィールドrpgの良さだから、
戦闘風景もフラットだし移行もフラット
背景色もわざわざ変化したり、大幅に描画されるオブジェクトが毎回(ibのおもちゃ箱みたいな)
切り替わったら目が忙くてフラットじゃないと思うんだよね
だから背景エフェクトがアールエスみたいになるのは気味が悪いと思う

ならやっぱり普通に近づいて、
単純に拡大し、敵が眼前に並ぶ。
そのroadとcharsの組み合わせ状態の画面をリール回転して、
複数戦を演出すればいいと思う。
**リール回転中にcharsを切り替えるみたいな**

### エンカウントのエフェクトとカメラを決めた
ズームに影響されずぱっと現れて、
周りを円状に動く丸い円がタラタタって感じで最初だけ回る感じ
waveは方向性だけチラッと見えるように薄く作用する感じで

なんでかって言うと元々敵の方からズームする前提で考えてたけど、
それだと余りにも歩き状態と変化なさすぎるから
メインのカメラがズームする感じにするけど、
それだと敵がズームする動きにしちゃうと過剰だから、
こっちがズームするなら敵はぱっとだけ現れて、
最初に出てきた感出すために円状の丸い円で示すのがちょうどいい

##### 属性相性(印象だから無属性とかない)
印象だから、本人にその意思がなくても
==その印象が精神の属性となる、観察者から与えられる区分けとして==

~~無属性攻撃を実装（属性判定がない）~~
~~その代わり全ての属性防御の半分が入る？~~


